<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">

<section layout:fragment="content" class="admin-page">

    <h2>ğŸ› ï¸ ë°ëª¨ ë°ì´í„° ê´€ë¦¬ì í˜ì´ì§€</h2>
    <p>ì´ í˜ì´ì§€ì—ì„œ ë°ëª¨ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì„¹ì…˜ì—ì„œ ì›í•˜ëŠ” ì¡°ê±´ì„ ì…ë ¥í•˜ê³  ìˆ˜ì§‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
    <div id="status-message" class="status-message"></div>

    <div class="admin-section">
        <h3>1. ë°ì´í„° ìˆ˜ì§‘ (Crawling)</h3>

        <div class="platform-section">
            <h4>ğŸ¬ TMDB (ì˜í™”/TVì‡¼)</h4>
            <div class="input-group">
                <label for="tmdb-start-year">ì‹œì‘ ì—°ë„:</label>
                <input type="number" id="tmdb-start-year" value="2025" class="form-input">
                <label for="tmdb-end-year">ì¢…ë£Œ ì—°ë„:</label>
                <input type="number" id="tmdb-end-year" value="2024" class="form-input">
                <button onclick="callTmdbApi('/api/crawl/tmdb/movies-by-year', 'TMDB ì˜í™” ì „ì²´')">ì˜í™” ì „ì²´ ìˆ˜ì§‘</button>
                <button onclick="callTmdbApi('/api/crawl/tmdb/tv-by-year', 'TMDB TVì‡¼ ì „ì²´')">TVì‡¼ ì „ì²´ ìˆ˜ì§‘</button>
            </div>
            <p class="description">ì§€ì •í•œ ì—°ë„ ì‚¬ì´ì˜ ëª¨ë“  ì½˜í…ì¸ ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤. (ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</p>
            <hr>
            <div class="input-group">
                <label for="tmdb-sample-pages">ì¸ê¸° ìƒ˜í”Œ (í˜ì´ì§€ ìˆ˜):</label>
                <input type="number" id="tmdb-sample-pages" value="2" class="form-input">
                <button onclick="callTmdbPopularSampleApi('/api/test/tmdb/collect/popular-movies', 'ì¸ê¸° ì˜í™” ìƒ˜í”Œ ìˆ˜ì§‘')">ì¸ê¸° ì˜í™” ìƒ˜í”Œ ìˆ˜ì§‘</button>
                <button onclick="callTmdbPopularSampleApi('/api/test/tmdb/collect/popular-tv', 'ì¸ê¸° TVì‡¼ ìƒ˜í”Œ ìˆ˜ì§‘')">ì¸ê¸° TVì‡¼ ìƒ˜í”Œ ìˆ˜ì§‘</button>
            </div>
            <div class="input-group">
                <label for="tmdb-sample-year">ì—°ë„ë³„ ìƒ˜í”Œ (ì—°ë„):</label>
                <input type="number" id="tmdb-sample-year" value="2023" class="form-input">
                <label for="tmdb-sample-year-pages">í˜ì´ì§€ ìˆ˜:</label>
                <input type="number" id="tmdb-sample-year-pages" value="2" class="form-input">
                <button onclick="callTmdbYearSampleApi('/api/test/tmdb/collect/movies-by-year/sample', 'ì—°ë„ë³„ ì˜í™” ìƒ˜í”Œ ìˆ˜ì§‘')">ì—°ë„ë³„ ì˜í™” ìƒ˜í”Œ ìˆ˜ì§‘</button>
                <button onclick="callTmdbYearSampleApi('/api/test/tmdb/collect/tv-by-year/sample', 'ì—°ë„ë³„ TVì‡¼ ìƒ˜í”Œ ìˆ˜ì§‘')">ì—°ë„ë³„ TVì‡¼ ìƒ˜í”Œ ìˆ˜ì§‘</button>
            </div>
            <p class="description">í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì†ŒëŸ‰ì˜ í˜ì´ì§€ë§Œ ìƒ˜í”Œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>
        </div>

        <div class="platform-section">
            <h4>ğŸ® Steam (ê²Œì„)</h4>
            <div class="input-group">
                <label for="steam-appid">íŠ¹ì • ê²Œì„ AppID:</label>
                <input type="number" id="steam-appid" placeholder="ì˜ˆ: 730 (CS2)" class="form-input">
                <button onclick="callSteamByAppIdApi()">AppIDë¡œ ìˆ˜ì§‘</button>
            </div>
            <p class="description">íŠ¹ì • ê²Œì„ì˜ AppIDë¥¼ ì…ë ¥í•˜ì—¬ ê°œë³„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>
            <hr>
            <div class="input-group">
                <label for="steam-start-index">ì‹œì‘ ì¸ë±ìŠ¤:</label>
                <input type="number" id="steam-start-index" value="0" class="form-input">
                <label for="steam-end-index">ì¢…ë£Œ ì¸ë±ìŠ¤:</label>
                <input type="number" id="steam-end-index" value="100" class="form-input">
                <button onclick="callSteamApi()">ë²”ìœ„ ì§€ì • ìˆ˜ì§‘</button>
                <button onclick="callApi('/api/steam/collect/all-games', 'POST', null, 'Steam ì „ì²´ ê²Œì„ ìˆ˜ì§‘')">ì „ì²´ ê²Œì„ ìˆ˜ì§‘ (ìë™ ë¶„í• )</button>
            </div>
            <p class="description">ë²”ìœ„ë¥¼ ì§€ì •í•˜ê±°ë‚˜, ì „ì²´ ê²Œì„(1000ê°œì”© ìë™ ë¶„í• )ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>
        </div>

        <div class="platform-section">
            <h4>ğŸ“– ë„¤ì´ë²„ ì›¹íˆ°</h4>
            <div class="input-group">
                <label for="webtoon-pages">ì™„ê²° (í˜ì´ì§€ ìˆ˜):</label>
                <input type="number" id="webtoon-pages" value="5" class="form-input">
                <button onclick="callWebtoonFinishedApi()">ì™„ê²° ì›¹íˆ° ìˆ˜ì§‘</button>
            </div>
            <div class="input-group">
                <label for="webtoon-weekday">ìš”ì¼ ì§€ì •:</label>
                <select id="webtoon-weekday" class="form-input">
                    <option value="mon">ì›”ìš”ì¼</option>
                    <option value="tue">í™”ìš”ì¼</option>
                    <option value="wed">ìˆ˜ìš”ì¼</option>
                    <option value="thu">ëª©ìš”ì¼</option>
                    <option value="fri">ê¸ˆìš”ì¼</option>
                    <option value="sat">í† ìš”ì¼</option>
                    <option value="sun">ì¼ìš”ì¼</option>
                </select>
                <button onclick="callWebtoonWeekdayApi()">ìš”ì¼ë³„ ìˆ˜ì§‘</button>
                <button onclick="callApi('/api/crawl/naver-webtoon/all-weekdays/sync', 'POST', null, 'ë„¤ì´ë²„ ì›¹íˆ° ì „ì²´ ìš”ì¼ ìˆ˜ì§‘')">ì „ì²´ ìš”ì¼ ìˆ˜ì§‘</button>
            </div>
        </div>

        <div class="platform-section">
            <h4>ğŸ“š ì›¹ì†Œì„¤ (ë„¤ì´ë²„ ì‹œë¦¬ì¦ˆ / ì¹´ì¹´ì˜¤í˜ì´ì§€)</h4>

            <div class="input-group-sub">
                <h5>ë„¤ì´ë²„ ì‹œë¦¬ì¦ˆ</h5>
                <label for="ns-novel-pages">ìˆ˜ì§‘ í˜ì´ì§€ ìˆ˜:</label>
                <input type="number" id="ns-novel-pages" value="2" class="form-input">
                <button onclick="callNaverSeriesApi()">ë„¤ì´ë²„ ì‹œë¦¬ì¦ˆ ì¸ê¸°ì‘ ìˆ˜ì§‘</button>
            </div>
            <hr>
            <div class="input-group-sub">
                <h5>ì¹´ì¹´ì˜¤í˜ì´ì§€</h5>
                <div class="input-row">
                    <label for="kp-genre">ì¥ë¥´:</label>
                    <select id="kp-genre" class="form-input">
                        <option value="0">ì „ì²´</option>
                        <option value="86">íŒíƒ€ì§€</option>
                        <option value="120">í˜„ëŒ€íŒíƒ€ì§€</option>
                        <option value="117">ë¡œë§¨ìŠ¤íŒíƒ€ì§€</option>
                        <option value="89">ë¡œë§¨ìŠ¤</option>
                        <option value="87">ë¬´í˜‘</option>
                    </select>
                </div>
                <div class="input-row">
                    <label for="kp-sort-type">ì •ë ¬:</label>
                    <select id="kp-sort-type" class="form-input">
                        <option value="UPDATE">ì—…ë°ì´íŠ¸ ìˆœ</option>
                        <option value="PRODUCT_LATEST">ë“±ë¡ì¼ ìˆœ</option>
                    </select>
                    <label for="kp-is-complete">ì™„ê²° ì—¬ë¶€:</label>
                    <select id="kp-is-complete" class="form-input">
                        <option value="false">ì—°ì¬ì¤‘</option>
                        <option value="true">ì™„ê²°</option>
                    </select>
                </div>
                <div class="input-row">
                    <label for="kp-novel-pages">ìˆ˜ì§‘ í˜ì´ì§€ ìˆ˜:</label>
                    <input type="number" id="kp-novel-pages" value="2" class="form-input">
                    <button onclick="callKakaoPageApi()">ì¹´ì¹´ì˜¤í˜ì´ì§€ ì¡°ê±´ë³„ ìˆ˜ì§‘</button>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-section">
        <h3>2. ìˆ˜ì§‘ ë°ì´í„° í†µí•© ì²˜ë¦¬ (Batch Process)</h3>
        <div class="input-group">
            <label for="batch-size">ë°°ì¹˜ í¬ê¸°:</label>
            <input type="number" id="batch-size" value="100" class="form-input">
            <button onclick="callBatchProcessApi()">ìˆ˜ì§‘ëœ ë°ì´í„° í†µí•© ì‹¤í–‰</button>
        </div>
        <p class="description">
            ë°ì´í„° ìˆ˜ì§‘ í›„, ì´ ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ìˆ˜ì§‘ëœ ì›ë³¸(`RawItem`) ë°ì´í„°ê°€ ë¶„ì„ ë° ì •ê·œí™” ê³¼ì •ì„ ê±°ì³ ìµœì¢… ì½˜í…ì¸ (`Content`) DBì— ì €ì¥ë©ë‹ˆë‹¤.
            ë°°ì¹˜ í¬ê¸°ë¥¼ ì¡°ì •í•˜ì—¬ í•œ ë²ˆì— ì²˜ë¦¬í•  ë°ì´í„° ê°œìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
    </div>

    <script>
        // ë²”ìš© API í˜¸ì¶œ í•¨ìˆ˜
        function callApi(endpoint, method, body, taskName) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = `â³ '${taskName}' ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤... (ì—”ë“œí¬ì¸íŠ¸: ${endpoint})`;
            statusDiv.className = 'status-message-processing';

            const options = {
                method: method,
                headers: { 'Content-Type': 'application/json' }
            };

            if (method.toUpperCase() !== 'GET' && body) {
                options.body = JSON.stringify(body);
            }

            fetch(endpoint, options)
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => { throw new Error(`[${response.status}] ${text || response.statusText}`) });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                    const message = data.message || `ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    statusDiv.textContent = `âœ… '${taskName}' ì‘ì—… ì„±ê³µ: ${message}`;
                    statusDiv.className = 'status-message-success';
                })
                .catch(error => {
                    console.error('API Call Error:', error);
                    statusDiv.textContent = `âŒ '${taskName}' ì‘ì—… ì‹¤íŒ¨: ${error.message}`;
                    statusDiv.className = 'status-message-error';
                });
        }

        // --- ê° í”Œë«í¼ë³„ API í˜¸ì¶œ ë˜í¼ í•¨ìˆ˜ ---

        function callTmdbApi(baseEndpoint, taskName) {
            const startYear = document.getElementById('tmdb-start-year').value;
            const endYear = document.getElementById('tmdb-end-year').value;
            const endpoint = `${baseEndpoint}?startYear=${startYear}&endYear=${endYear}`;
            callApi(endpoint, 'POST', null, taskName);
        }

        // [ê°œì„ ] ì¸ê¸° ìƒ˜í”Œ ìˆ˜ì§‘ í•¨ìˆ˜ë¥¼ ì˜í™”/TVì‡¼ ê³µìš©ìœ¼ë¡œ ë³€ê²½
        function callTmdbPopularSampleApi(endpoint, taskName) {
            const pages = document.getElementById('tmdb-sample-pages').value;
            const fullEndpoint = `${endpoint}?pages=${pages}`;
            callApi(fullEndpoint, 'POST', null, taskName);
        }

        // [ê°œì„ ] ì—°ë„ë³„ ìƒ˜í”Œ ìˆ˜ì§‘ í•¨ìˆ˜ë¥¼ ì˜í™”/TVì‡¼ ê³µìš©ìœ¼ë¡œ ë³€ê²½
        function callTmdbYearSampleApi(endpoint, taskName) {
            const year = document.getElementById('tmdb-sample-year').value;
            const pages = document.getElementById('tmdb-sample-year-pages').value;
            const fullEndpoint = `${endpoint}?year=${year}&pages=${pages}`;
            callApi(fullEndpoint, 'POST', null, taskName);
        }

        function callSteamByAppIdApi() {
            const appId = document.getElementById('steam-appid').value;
            if (!appId || appId.trim() === '') {
                alert('AppIDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            const body = { appId: parseInt(appId) };
            callApi('/api/steam/collect/by-appid', 'POST', body, `Steam ê²Œì„ AppID ${appId} ìˆ˜ì§‘`);
        }

        function callSteamApi() {
            const start = document.getElementById('steam-start-index').value;
            const end = document.getElementById('steam-end-index').value;
            const endpoint = `/api/test/steam/collect-games-by-range?start=${start}&end=${end}`;
            callApi(endpoint, 'POST', null, 'Steam ë²”ìœ„ ì§€ì • ìˆ˜ì§‘');
        }

        function callWebtoonFinishedApi() {
            const maxPages = document.getElementById('webtoon-pages').value;
            const body = { maxPages: parseInt(maxPages) };
            callApi('/api/crawl/naver-webtoon/finished/sync', 'POST', body, 'ë„¤ì´ë²„ ì™„ê²° ì›¹íˆ° ìˆ˜ì§‘');
        }

        function callWebtoonWeekdayApi() {
            const weekday = document.getElementById('webtoon-weekday').value;
            const body = { weekday: weekday };
            callApi('/api/crawl/naver-webtoon/weekday/sync', 'POST', body, `ë„¤ì´ë²„ ${weekday}ìš”ì¼ ì›¹íˆ° ìˆ˜ì§‘`);
        }

        // ë„¤ì´ë²„ ì‹œë¦¬ì¦ˆ API í˜¸ì¶œ í•¨ìˆ˜ (ID ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ ns-novel-pagesë¡œ ë³€ê²½)
        function callNaverSeriesApi() {
            const pages = document.getElementById('ns-novel-pages').value;
            const body = { pages: parseInt(pages) };
            callApi('/api/crawl/naver-series', 'POST', body, 'ë„¤ì´ë²„ ì‹œë¦¬ì¦ˆ ì›¹ì†Œì„¤ ìˆ˜ì§‘');
        }

        // ì¹´ì¹´ì˜¤í˜ì´ì§€ API í˜¸ì¶œ í•¨ìˆ˜ (ìƒˆë¡œìš´ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë§ê²Œ ëŒ€í­ ìˆ˜ì •)
        function callKakaoPageApi() {
            // ìƒˆë¡œ ì¶”ê°€ëœ UIì—ì„œ ê°’ë“¤ì„ ì½ì–´ì˜µë‹ˆë‹¤.
            const categoryUid = 11; // 11: ì›¹ì†Œì„¤ (ê³ ì •)
            const subcategoryUid = document.getElementById('kp-genre').value;
            const sortType = document.getElementById('kp-sort-type').value;
            const isComplete = document.getElementById('kp-is-complete').value;
            const pages = document.getElementById('kp-novel-pages').value;

            // sectionIdë¥¼ ì¡°í•©í•˜ì—¬ ìƒì„±í•©ë‹ˆë‹¤. (ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ê¸°ë³¸ê°’ ìƒì„± ë¡œì§ê³¼ ìœ ì‚¬)
            const sectionId = `static-landing-Genre-section-Landing-${categoryUid}-${subcategoryUid}-${sortType}-${isComplete}`;

            // ìƒˆë¡œìš´ API DTO í˜•ì‹ì— ë§ëŠ” body ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
            const body = {
                sectionId: sectionId,
                categoryUid: parseInt(categoryUid),
                subcategoryUid: subcategoryUid,
                sortType: sortType,
                isComplete: (isComplete === 'true'), // ë¬¸ìì—´ 'true'ë¥¼ boolean trueë¡œ ë³€í™˜
                pages: parseInt(pages)
            };

            // ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
            callApi('/api/crawl/kakaopage/api', 'POST', body, 'ì¹´ì¹´ì˜¤í˜ì´ì§€ ì›¹ì†Œì„¤ ìˆ˜ì§‘');
        }

        // ë°°ì¹˜ ì²˜ë¦¬ API í˜¸ì¶œ í•¨ìˆ˜
        function callBatchProcessApi() {
            const batchSize = document.getElementById('batch-size').value;
            const body = { batchSize: parseInt(batchSize) };
            callApi('/api/batch/process', 'POST', body, 'ë°ì´í„° í†µí•© ì²˜ë¦¬');
        }

    </script>
</section>

</html>